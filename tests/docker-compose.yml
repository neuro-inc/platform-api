zookeeper:
  image: mesoscloud/zookeeper:3.4.6-centos-7
  ports:
    - "2181:2181"
    - "2888:2888"
    - "3888:3888"
  environment:
    SERVERS: 'server.1=127.0.0.1'
    MYID: '1'

mesosmaster:
  image: mesosphere/mesos-master:1.4.1
  ports:
    - "5050:5050"
  volumes:
    - ./logs:/var/log/mesos
  links:
    - zookeeper
  environment:
    MESOS_ZK: 'zk://zookeeper:2181/mesos'
    MESOS_QUORUM: '1'
    MESOS_HOSTNAME: 'mesosmaster'
    MESOS_LOG_DIR: '/var/log/mesos'
    MESOS_WORK_DIR: "/var/tmp/mesos"
    MESOS_PORT: 5050
    MESOS_REGISTRY: in_memory

mesosslave:
  image: mesosphere/mesos-slave:1.4.1

  command: "--no-systemd_enable_support"
  privileged: true
  ports:
    - "5051:5051"
  volumes:
    - ./logs:/var/log/mesos
    - ./sandbox:/var/tmp/mesos
    - /sys:/sys
    - /var/run/docker.sock:/var/run/docker.sock:rw
    - ./docker.tar.gz:/etc/docker.tar.gz
  links:
    - zookeeper
    - mesosmaster
  environment:
    MESOS_MASTER: 'zk://zookeeper:2181/mesos'
    MESOS_PORT: '5051'
    MESOS_HOSTNAME: 'mesosslave'
    MESOS_LOG_DIR: '/var/log/mesos'
    MESOS_WORK_DIR: '/var/tmp/mesos'
    MESOS_CONTAINERIZERS: 'docker,mesos'
    MESOS_EXECUTOR_REGISTRATION_TIMEOUT: '5mins'
    MESOS_EXECUTOR_SHUTDOWN_GRACE_PERIOD: '90secs'
    MESOS_DOCKER_STOP_TIMEOUT: '60secs'

singularity:
  image: hubspot/singularityservice:0.18.2

  ports:
    - "7099:7099"

  links:
    - zookeeper
    - mesosmaster
    - mesosslave

  environment:
    SINGULARITY_ZK: zookeeper:2181
    SINGULARITY_MESOS_MASTER: mesosmaster:5050
